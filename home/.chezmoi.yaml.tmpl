{{- $globalCache := "0" }}
{{- $personal := and (lt (.chezmoi.hostname|len) 15) (ne .chezmoi.hostname .chezmoi.username) -}}
{{- $localRoot := print .chezmoi.homeDir "/.local" }}
{{- $localBin := print $localRoot "/bin" }}
{{- $localGPG := print $localRoot "/gpg.d" }}
{{- $userHome := .chezmoi.homeDir }}
{{- $userBin := print $userHome "/bin" }}
{{- $userConfig := print $userHome "/.config" }}
{{- $goPath := print $userHome "/go" }}
{{- $goRoot := print $localRoot "/go" }}
{{- $rustCargo := print $userHome "/.cargo" }}
{{- $linuxFamily := "" }}
{{- $linuxVersion := "" }}

{{- if eq .chezmoi.os "linux" }}
{{- $linuxFamily = .chezmoi.osRelease.id }}
{{- $linuxVersion = .chezmoi.osRelease.versionCodename }}
{{- end }}

diff:
  command: "difft"
  exclude:
    - scripts
git:
  autoCommit: false

data:
  arch: {{ quote .chezmoi.arch }}
  os: {{ quote .chezmoi.os }}
  personal: {{ $personal }}
  paths:
    local:
      bin: {{ quote $localBin }}
      gpg: {{ quote $localGPG }}
      root: {{ quote $localRoot }}
    user:
      bin: {{ quote $userBin }}
      config: {{ quote $userConfig }}
      home: {{ quote $userHome }}
    go:
      gopath: {{ quote $goPath }}
      goroot: {{ quote $goRoot }}
    rust:
      cargo: {{ quote $rustCargo }}
  user: {{ quote .chezmoi.username }}
  cache:
    global: {{ $globalCache }}
  {{- if eq .chezmoi.os "darwin" }}
  homebrew:
    formulae:
      - ag
      - ansible
      - bash
      - bash-language-server
      - btop
      - bufbuild/buf/buf
      - clang-format
      - cmake
      - coreutils
      - curl
      - difftastic
      - direnv
      - docker
      - docker-compose
      - exa
      - fd
      - gcc
      - gh
      - git
      - htop
      - jq
      - keychain
      - llvm
      - npm
      - python3
      - ruby
      - shellcheck
      - telnet
      - tree
      - watch
      - yaml-language-server
      - yq
      - zig --HEAD
    casks:
      - 1password
      - alfred
      - bartender
      - dropbox
      - espanso
      - fork
      - iterm2
      - macfuse
      - slack
      - spectacle
      - spotify
      {{- if $personal }}
      - brave-browser
      - docker
      - google-cloud-sdk
      - nordvpn
      - tailscale
      - transmission
      - veracrypt
      {{- end }}
  {{- end }}
  {{- if eq .chezmoi.os "linux" }}
  apt:
    prerequisites:
      - build-essential
      - clang-13
      - clang-format-13
      - cmake
      - curl
      - gcc
      - git
      - llvm-13  
      - lsb-release
    gpg_keys:
      - name: docker
        url: "https://download.docker.com/linux/{{ $linuxFamily }}/gpg"
        args: --dearmor
      - name: github
        url: "https://cli.github.com/packages/githubcli-archive-keyring.gpg"
        verbatim: true
    apt_keys:
      - name: docker
        server: keyserver.ubuntu.com
        id: 7EA0A9C3F273FCD8
      - name: github
        server: keyserver.ubuntu.com
        id: 23F3D4EA75716059
    repositories:
      - name: docker
        url: "https://download.docker.com/linux/{{ $linuxFamily }}"
        branch: "{{ $linuxVersion }} stable"
      - name: github
        url: "https://cli.github.com/packages"
        branch: "stable main"
    packages:
      - ansible
      - bash
      - direnv
      - docker-ce
      - docker-compose
      - exa
      - fd-find
      - gh
      - htop
      - jq
      - keychain
      - python3
      - ruby
      - shellcheck
      - silversearcher-ag
      - telnet
      - tree
    alternatives:
      - src: /usr/bin/llvm-config-13
        dst: /usr/bin/llvm-config
        related:
          {{- $llvmCmds := list "ar" "as" "bcanalyzer" "cov" "diff" "dis" "dwarfdump" "extract" "link" "mc" "mcmarkup" "nm" "objcopy" "objdump" "ranlib" "readobj" "rtdyld" "size" "stress" "strip" "symbolizer" "tblgen" }}
          {{ range $cmd := $llvmCmds }}
          - src: /usr/bin/llvm-{{ $cmd }}-13
            dst: /usr/bin/llvm-{{ $cmd }}
          {{ end }}
      - src: /usr/bin/clang-13
        dst: /usr/bin/clang
        related:
          - src: /usr/bin/clang++-13
            dst: /usr/bin/clang++
          - src: /usr/bin/clang-cpp-13
            dst: /usr/bin/clang-cpp
      - src: /usr/bin/clang-format-13
        dst: /usr/bin/clang-format
        related:
          - src: /usr/bin/clang-format-diff-13
            dst: /usr/bin/clang-format-diff
          - src: /usr/bin/git-clang-format-13
            dst: /usr/bin/git-clang-format
      - src: /usr/bin/fdfind
        dst: /usr/bin/fd
  {{- end }}
  crates:
    - bat --locked
    - cargo-binutils
    - cargo-make
    - cargo-outdated
    - cargo-sort
    - cargo-tarpaulin
    - cargo-watch
    - difftastic
    - just
    - zellij --locked
  
  versions:
    bazelisk: "v1.16.0"
    btop: "1.2.13"
    buf: "v1.15.0"
    fzf: "0.38.0"
    go: "1.20.1"
    golangci_lint: "v1.51.2"
    helix: "22.12"
    tmux: "3.3a"
    yq: "v4.31.2"
    zig: "0.10.1"
