{{- $globalCache := "1" -}}
{{- $personal := and (lt (len .chezmoi.hostname) 15) (ne .chezmoi.hostname .chezmoi.username) -}}
{{- $localRoot := print .chezmoi.homeDir "/.local" -}}
{{- $localBin := print $localRoot "/bin" -}}
{{- $userHome := .chezmoi.homeDir -}}
{{- $userBin := print $userHome "/bin" }}
{{- $userConfig := print $userHome "/.config" -}}
{{- $goPath := print $userHome "/go" -}}
{{- $goPathBin := print $goPath "/bin" -}}
{{- $goRoot := print $localRoot "/go" -}}
{{- $goRootBin := print $goRoot "/bin" -}}
{{- $cargoHome := print $userHome "/.cargo" -}}
{{- $cargoBin := print $cargoHome "/bin" -}}
{{- $userPythonBin := print (trim (output "python3" "-m" "site" "--user-base")) "/bin" -}}
{{- $pathFragments := list }}
{{- if eq .chezmoi.os "darwin" -}}
{{-   $pathFragments = list $userBin $localBin $cargoBin $goPathBin $goRootBin $userPythonBin "/opt/homebrew/sbin" "/opt/homebrew/bin" "/usr/local/sbin" "/usr/local/bin" }}
{{- else -}}
{{-   $pathFragments = list $userBin $localBin $cargoBin $goPathBin $goRootBin $userPythonBin "/usr/local/sbin" "/usr/local/bin" }}
{{- end -}}
{{- $computedPath := join ":" (uniq (concat $pathFragments (splitList ":" (env "PATH")))) -}}

diff:
  command: "difft"
  exclude:
    - scripts
git:
  autoCommit: false

data:
  arch: {{ quote .chezmoi.arch }}
  os: {{ quote .chezmoi.os }}
  personal: {{ $personal }}

  path:
    config: {{ $userConfig }}
    profiled: {{ print $userHome "/.profile.d" }}
    goroot: {{ $goRoot }}
    gopath: {{ $goPath }}
    local: {{ $localRoot }}
    cargo: {{ $cargoHome }}
    home: {{ $userHome }}
    path: {{ $computedPath }}
  
  paths:
    local:
      bin: {{ quote $localBin }}
      root: {{ quote $localRoot }}
    user:
      bin: {{ quote $userBin }}
      config: {{ quote $userConfig }}
      home: {{ quote $userHome }}
    go:
      gopath: {{ quote $goPath }}
      gobin: {{ quote (print $goPath "/bin") }}
      goroot: {{ quote $goRoot }}
    cargo:
      home: {{ quote $cargoHome }}
      bin: {{ quote (print $cargoHome "/bin") }}
  user: {{ quote .chezmoi.username }}
  cache:
    global: {{ $globalCache }}
  mw:
    packages:
      - go
      - rust
      - ag
      - ansible
      - bash
      - bat
      - btop
      - buf
      - cargo-*
      - clang-format
      - cmake
      - curl
      - difftastic
      - direnv
      - docker
      - docker-compose
      - exa
      - fd
      - fzf
      - gcc
      - gh
      - git
      - golangci-lint
      - gopls
      - helix
      - htop
      - jq
      - just
      - keychain
      - llvm
      - npm
      - python3
      - ruby
      - shellcheck
      - telnet
      - tree
      - watch
      - zellij
      {{- if eq .chezmoi.os "darwin" }}
      - coreutils
      - 1password
      - alfred
      - bartender
      - docker-desktop
      - dropbox
      - espanso
      - fork
      - iterm2
      - macfuse
      - slack
      - spectacle
      - spotify
      {{- if $personal }}
      - brave-browser
      - docker
      - google-cloud-sdk
      - nordvpn
      - tailscale
      - transmission
      - veracrypt
      {{- else }}
      - llc # TODO
      - imp # TODO
      {{- end }}
      {{- end }}
      {{- if eq .chezmoi.os "linux" }}
      - build-essential
      - libevent-dev
      - lsb-release
      {{- end }}
    alternatives:
      - src: /usr/bin/llvm-config-13
        dst: /usr/bin/llvm-config
        related:
          {{- $llvmCmds := list "ar" "as" "bcanalyzer" "cov" "diff" "dis" "dwarfdump" "extract" "link" "mc" "mcmarkup" "nm" "objcopy" "objdump" "ranlib" "readobj" "rtdyld" "size" "stress" "strip" "symbolizer" "tblgen" }}
          {{ range $cmd := $llvmCmds }}
          - src: /usr/bin/llvm-{{ $cmd }}-13
            dst: /usr/bin/llvm-{{ $cmd }}
          {{ end }}
      - src: /usr/bin/clang-13
        dst: /usr/bin/clang
        related:
          - src: /usr/bin/clang++-13
            dst: /usr/bin/clang++
          - src: /usr/bin/clang-cpp-13
            dst: /usr/bin/clang-cpp
      - src: /usr/bin/clang-format-13
        dst: /usr/bin/clang-format
        related:
          - src: /usr/bin/clang-format-diff-13
            dst: /usr/bin/clang-format-diff
          - src: /usr/bin/git-clang-format-13
            dst: /usr/bin/git-clang-format
      - src: /usr/bin/fdfind
        dst: /usr/bin/fd
