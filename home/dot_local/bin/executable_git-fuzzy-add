#!/usr/bin/env bash

fzf_preview() {
	GIT_EXTERNAL_DIFF='difft --color=always --display=inline' \
		fzf -m --height=50% -q "$1" --preview 'git diff --color=always --minimal {}'
}

# shellcheck disable=SC2086,SC2155
_fn() {
	readonly changed="$(git diff --name-only | fzf_preview "$1")"
	[ -z "$changed" ] || git add $changed
}

_fn "$@"
