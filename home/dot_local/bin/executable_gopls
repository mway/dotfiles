#!/usr/bin/env bash
set -eo pipefail

# shellcheck disable=SC2155
_fn() {
  readonly name="gopls"
  readonly prog="$(mw path "$name" 2>/dev/null || true)"
  readonly detected_version="$(mw version "$name" 2>/dev/null || true)"
  readonly version="${detected_version:-"0.14.2"}"
  if [ ! -x "$prog" ] || [[ "$("$prog" version)" != *"$version"* ]]; then
	go install golang.org/x/tools/gopls@v$version
  fi

  exec "${prog:-"$(go env GOPATH)/bin/$name"}" "$@"
}

_fn "$@"
