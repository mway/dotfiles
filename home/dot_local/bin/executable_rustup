#!/usr/bin/env bash
set -eo pipefail

_fn() {
  readonly prog="$HOME/.cargo/bin/rustup"
  if [ ! -x "$prog" ]; then
    local tempdir="$(mktemp -d)"
    trap 'rm -rf $tempdir' EXIT
    cd "$tempdir"

    curl --proto '=https' --tlsv1.2 -sSfo rustup.sh https://sh.rustup.rs 
    chmod +x rustup.sh
    ./rustup.sh -y --no-modify-path
  fi

  exec "$prog" "$@"
}

_fn "$@"
