#!/usr/bin/env bash
set -eo pipefail

# shellcheck disable=SC2155
_fn() {
  readonly name="mw"
  readonly prog="$HOME/.cargo/bin/$name"
  readonly detected_version="$("$prog" version "$name" 2>/dev/null || true)"
  readonly version="${detected_version:-"0.2.1"}"
  if [ ! -x "$prog" ] || [[ "$("$prog" --version)" != *"$version"* ]]; then
    cargo install \
      --config net.git-fetch-with-cli=true    \
      --git ssh://git@github.com/mway/mway-rs \
      --tag "$version"                        \
      "$name"
  fi

  exec "$prog" "$@"
}

_fn "$@"
