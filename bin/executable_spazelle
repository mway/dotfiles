#!/usr/bin/env python3

import json
import os, os.path

SRC_PATH = "src/"
IGNORED_DIRS = [
    os.path.join(SRC_PATH, "code.uber.internal")
]

stream = os.popen("git status --porcelain | sed s/^...//")
lines = [x.strip() for x in stream.readlines()]
dirs = set()

for line in lines:
    if not line.startswith(SRC_PATH):
        continue
    line = line[:-1] if line.endswith("/") else os.path.dirname(line)
    if line in IGNORED_DIRS:
        continue
    dirs.add(line)

stream = os.popen("gazelle {}".format(" ".join(dirs)))
for line in stream:
    print(line, end="")
